# bash_manual_note
##1. Introduction

A shell is simply a macro processor that executes commands. The term macro processor means functionality where text and symbols are expanded to create larger expressios.

buitins function:
`cd` `break` `continue` `exec` `history` `getopts` `kill` `pwd`

##3. Basic Shell Features

bash is an acronym for 'Bourne-Again SHell'
Building blocks

* commands
* control structures
* shell functions
* shell parameters
* shell expansions
* redirections

###3.1 Shell Syntax
`#` is for comments
`cat /etc/passwd; #sjfosjdfoajsdfoajs`
> Otherwise, roughly speaking, the shell reads its input and divides the input into words and operators, employing the quoting rules to select which meanings to assign various words and characters.
The shell then parses these tokens into commands and other constructs, removes the special meaning of certain words or characters, expands others, redirects input and output as needed, executes the specified command, waits for the command’s exit status, and makes that exit status available for further inspection or processing.

####3.1.2 Quoting
Quting is used to remove the special meaning of certain characters or words to the shell
Quoting mechanisms:

* the escape character
	* `\` Bash escape character.
	*  preserve the literal value of the next character that follows
	*  `\newline` is treated as a line continuation
* single quotes
	* `''` - preserves the literal value of each character within the quotes
	* `abc='THis is a joke'; echo '$abc'` -> $abc
* double quotes
	* Enclosing characters in double quotes (‘"’) preserves the literal value of all characters within the quotes, with the exception of ‘$’, ‘‘’, ‘\’, and, when history expansion is enabled, ‘!’.
	* The backslash retains its special meaning only when followed by one of the following characters: ‘$’, ‘‘’, ‘"’, ‘\’, or newline.
	* `abc='THis is a joke'; echo "$abc"` -> THis is a joke
	* `"\$"` -> $
	* `"\""` -> "
	* `"\b"` -> \b

#### 3.1.2.4 ANSI-C Quoting
`$'command'` such as `$'cat' /etc/passwd`

### 3.1.3 Comments
`interactive_comments` option to the `shopt` builtin is enable.
An interactive shell without the `interactive_comments` option enabled does not allow comments. The `interactive_comments` option is on by default in interactive shells.

## 3.2 Shell Commands
> The return status (see Section 3.7.5 [Exit Status], page 39) of a simple command is its exit status as provided by the posix 1003.1 `waitpid` function, or 128+n if the command was terminated by signal n.

### 3.2.2 Pipelines
control operator `|` or `|&`
`cat /etc/passwd | grep -v -E '(nologin|false)'`

`|&` == `2>&1 |` implicit redirection < explicit redirection
>  When the shell is in posix mode (see Section 6.11 [Bash POSIX Mode], page 96), it does not recognize time as a reserved word if the next token begins with a ‘-’. The TIMEFORMAT variable may be set to a format string that specifies how the timing information should be displayed.

### 3.2.3 Lists of Commands
`apt update && apt upgrade && ssr start &`
`apt update; apt upgrade; ssr start &;`

`echo abc && echo abc`
command2 is executed if, and only if, command1 returns an exit status of zero.

`asdf || echo abc` 
command2 is executed if, and only if, command1 returns a non-zero exit status.

### 3.2.4 Compound Commands
* Looping Constructs
	* `;` may be replaced with one or more newlines
	* `until`: `random=1; until [ $random -lt 65535 ] && [ $random -gt 1024 ]; do let "random=$RANDOM*10";echo $random; done`
	* `while`: `a=1; while [ $a -le 10 ]; do let "a += 1";echo $a;done`
	* for:
* Conditional Constructs
	* if:
	* case: 
	* select: ```
select fname in *;
     do
     echo you picked $fname \($REPLY\)
     break;
     done
	```
	* `(())`: `((a+=1))` == `let "a+=1"`
	* `[[]]`: 

#### 3.2.4.3 Grouping Commands
() 

------------
#Bash-Beginners-Guide

##2.1 Creating and Running a script

in `vim` enable syntax 

* `:syntax enable`
* `:sy enable`
* `:syn enable`

`which -a script_name`
`whereis script_name`
`locate script_name`

run the script

> * `rbash script_name.sh`
> * `sh script_name.sh`
> * `bash -x script_name.sh`

the command above will execute the script in a subshell which will not affect the session of the parent shell

add the directory into `PATH` variable
> `export PATH="$PATH:~/scripts"`

This will not start a new shell but execute the script in the current shell. __AND THIS SCRIPT _DOES NOT_ NEED EXECUTION PERMISSION__
> `source script_name.sh`

##2.2 Script basics
start with
`#!/bin/bash`

comment with `#`

## 2.3 Debugging Bash scripts
debug mode: `bash -x script_name.sh`

```
set -x # activate debugging from here -:activate
w
set +x # deactivate debugging from here +:deactivate
```

command | explanation 
--- | --- 
set -f | Disable file name generation using metacharacters (globbing).
set -v | Prints shell input lines as they are read.
set -x | Print command traces before executing command.

####macos
```
nobody1s-MacBook-Pro:scripts noone$ set -f
nobody1s-MacBook-Pro:scripts noone$ ls *
ls: *: No such file or directory
nobody1s-MacBook-Pro:scripts noone$ set +f
nobody1s-MacBook-Pro:scripts noone$ ls *
script1.sh
```

```
nobody1s-MacBook-Pro:scripts noone$ set -v
__bp_precmd_invoke_cmd; __bp_interactive_mode
__bp_preexec_invoke_exec "$_"
type -t iterm2_generate_ps1
iterm2_prompt_prefix
iterm2_prompt_mark
iterm2_prompt_suffix
__bp_preexec_invoke_exec "$_"
nobody1s-MacBook-Pro:scripts noone$ ls
ls
__bp_preexec_invoke_exec "$_"
__bp_trim_whitespace "$1"
__bp_trim_whitespace "$command"
__bp_trim_whitespace "$command"
HISTTIMEFORMAT= builtin history 1 | { IFS=" " read -r _ this_command; echo "$this_command"; }
script1.sh
__bp_precmd_invoke_cmd; __bp_interactive_mode
__bp_preexec_invoke_exec "$_"
type -t iterm2_generate_ps1
iterm2_prompt_prefix
iterm2_prompt_mark
iterm2_prompt_suffix
__bp_preexec_invoke_exec "$_"
```

declare in the first line
`#!/bin/bash -xv`

##3.1 Shell initialization files
### 3.1.1 system wide configuration
`/etc/profile` (must have and system wide)

* when invoked interactively with `--login` option or when invoked as `sh`
*  usually set `PATH` `USER` `MAIL` `HOSTNAME` `HISTSIZE`
*  some system set `umask`, other points to other configuration files
	* `/etc/inputrc`, the system-wide Readline initialization file where you can configure the command line bell-style
	* the `/etc/profile.d` directory, which contains files configuring system-wide behavior of specific programs

`/etc/bashrc`(must have and system wide)

* bash-specific configuration file
* `~/.bashrc` might point to `/etc/bashrc`
* `/etc/bashrc` file might be referred to in `/etc/profile`


`~/.bash_profile` (optional and individual user) 

* configuration file for individual user environment

`~/.bash_login`

* This file contains specific settings that are normally only executed when you log in to the system.
* in the absence of `~/.bash_profile`, this file will be read

`~/.profile`

* In the absence of `~/.bash_profile` and `~/.bash_login`, `~/.profile` is read
* also accessible by other shells


`~/.bashrc`

* when non-login shell, bash searches for it and also it is referred to in the files read upon login as well.

`~/.bash_logout`

* contains specific instructions for the logout procedure
## 3.2 Variables
###3.2.1 Types of variables

Global variables

* 	`env` and `printenv` from `sh-utils` package

Local variables

* `set` built-in command without any options will display a list of all variables

Difference
`diff <(set | grep -E '^\w' | grep -v -E '(\(|_)') <(env | grep -E '^\w' | grep -v -E '(\(|_)') | awk '{ print $2}'`

`diff set.sorted printenv.sorted | grep "<" | awk '{ print $2 }'`

4 types variables:

* String variables
* Integer variables
* Constant variables
* Array variables

###3.2.2. Creating variables

`export abc="123"`

```
franky ~> MYVAR-2="2"
bash: MYVAR-2=2: command not found

franky ~> MYVAR1 ="2"
bash: MYVAR1: command not found

franky ~> MYVAR1= "2"
bash: 2: command not found

franky ~> unset MYVAR1 first_name full_name
```

### 3.2.3 Exporting Variables
`export VARNAME="value"` this variable exported that are referred to as environment variables which is awared by subshell

### 3.2.4 Reserved variables

sh reserved variables

Variable | name	Definition
--- | ---
CDPATH	| A colon-separated list of directories used as a search path for the cd built-in command.
HOME | The current user's home directory; the default for the cd built-in. The value of this variable is also used by tilde expansion.
IFS	| A list of characters that separate fields; used when the shell splits words as part of expansion.
MAIL | If this parameter is set to a file name and the MAILPATH | variable is not set, Bash informs the user of the arrival of mail in the specified file.
MAILPATH| A colon-separated list of file names which the shell periodically checks for new mail.
OPTARG| The value of the last option argument processed by the getopts built-in.
OPTIND| The index of the last option argument processed by the getopts built-in.
PATH | A colon-separated list of directories in which the shell looks for commands.
PS1	 | The primary prompt string. The default value is "'\s-\v\$ '".
PS2	 | The secondary prompt string. The default value is "'> '".

bash reserved variable

Variable name | Definition
--- | ---
auto_resume | This variable controls how the shell interacts with the user and job control.
BASH | The full pathname used to execute the current instance of Bash.
BASH_ENV| If this variable is set when Bash is invoked to execute a shell script, its value is expanded and used as the name of a startup file to read before executing the script.
BASH_VERSION | The version number of the current instance of Bash.
BASH_VERSINFO	 | A read-only array variable whose members hold version information for this instance of Bash.
COLUMNS | Used by the select built-in to determine the terminal width when printing selection lists. Automatically set upon receipt of a SIGWINCH signal.
COMP_CWORD| An index into ${COMP_WORDS} of the word containing the current cursor position.
COMP_LINE	| The current command line.
COMP_POINT | The index of the current cursor position relative to the beginning of the current command.
COMP_WORDS | An array variable consisting of the individual words in the current command line.
COMPREPLY | An array variable from which Bash reads the possible completions generated by a shell function invoked by the programmable completion facility.
DIRSTACK | An array variable containing the current contents of the directory stack.
EUID | The numeric effective user ID of the current user.
FCEDIT | The editor used as a default by the -e option to the fc built-in command.
FIGNORE | A colon-separated list of suffixes to ignore when performing file name completion.
FUNCNAME | The name of any currently-executing shell function.
GLOBIGNORE | A colon-separated list of patterns defining the set of file names to be ignored by file name expansion.
GROUPS | An array variable containing the list of groups of which the current user is a member.
histchars	| Up to three characters which control history expansion, quick substitution, and tokenization.
HISTCMD | The history number, or index in the history list, of the current command.
HISTCONTROL | Defines whether a command is added to the history file.
HISTFILE | The name of the file to which the command history is saved. The default value is ~/.bash_history.
HISTFILESIZE | The maximum number of lines contained in the history file, defaults to 500.
HISTIGNORE | A colon-separated list of patterns used to decide which command lines should be saved in the history list.
HISTSIZE | The maximum number of commands to remember on the history list, default is 500.
HOSTFILE | Contains the name of a file in the same format as /etc/hosts that should be read when the shell needs to complete a hostname.
HOSTNAME | The name of the current host.
HOSTTYPE | A string describing the machine Bash is running on.
IGNOREEOF| Controls the action of the shell on receipt of an EOF character as the sole input.
INPUTRC|The name of the Readline initialization file, overriding the default /etc/inputrc.
LANG | Used to determine the locale category for any category not specifically selected with a variable starting with LC_.
LC_ALL	| This variable overrides the value of LANG and any other LC_ variable specifying a locale category.
LC_COLLATE | This variable determines the collation order used when sorting the results of file name expansion, and determines the behavior of range expressions, equivalence classes, and collating sequences within file name expansion and pattern matching.
LC_CTYPE | This variable determines the interpretation of characters and the behavior of character classes within file name expansion and pattern matching.
LC_MESSAGES | This variable determines the locale used to translate double-quoted strings preceded by a "$" sign.
LC_NUMERIC|This variable determines the locale category used for number formatting.
LINENO	|The line number in the script or shell function currently executing.
LINES	|Used by the select built-in to determine the column length for printing selection lists.
MACHTYPE | A string that fully describes the system type on which Bash is executing, in the standard GNU CPU-COMPANY-SYSTEM format.
MAILCHECK	| How often (in seconds) that the shell should check for mail in the files specified in the MAILPATH or MAIL variables.
OLDPWD	| The previous working directory as set by the cd built-in.
OPTERR	| If set to the value 1, Bash displays error messages generated by the getopts built-in.
OSTYPE	| A string describing the operating system Bash is running on.
PIPESTATUS| An array variable containing a list of exit status values from the processes in the most recently executed foreground pipeline (which may contain only a single command).
POSIXLY_CORRECT|If this variable is in the environment when bash starts, the shell enters POSIX mode.
PPID|The process ID of the shell's parent process.
PROMPT_COMMAND|If set, the value is interpreted as a command to execute before the printing of each primary prompt (PS1).
PS3	|The value of this variable is used as the prompt for the select command. Defaults to "'#? '"
PS4	|The value is the prompt printed before the command line is echoed when the -x option is set; defaults to "'+ '".
PWD	|The current working directory as set by the cd built-in command.
RANDOM	| Each time this parameter is referenced, a random integer between 0 and 32767 is generated. Assigning a value to this variable seeds the random number generator.
REPLY	|The default variable for the read built-in.
SECONDS	| This variable expands to the number of seconds since the shell was started.
SHELLOPTS|	A colon-separated list of enabled shell options.
SHLVL	| Incremented by one each time a new instance of Bash is started.
TIMEFORMAT|The value of this parameter is used as a format string specifying how the timing information for pipelines prefixed with the time reserved word should be displayed.
TMOUT|If set to a value greater than zero, TMOUT is treated as the default timeout for the read built-in. In an interative shell, the value is interpreted as the number of seconds to wait for input after issuing the primary prompt when the shell is interactive. Bash terminates after that number of seconds if input does not arrive.
UID	|The numeric, real user ID of the current user.

Special bash variables

Character	| Definition
--- | ---
$*	| Expands to the positional parameters, starting from one. When the expansion occurs within double quotes, it expands to a single word with the value of each parameter separated by the first character of the IFS special variable.
$@	| Expands to the positional parameters, starting from one. When the expansion occurs within double quotes, each parameter expands to a separate word.
$#	| Expands to the number of positional parameters in decimal.
$?	| Expands to the exit status of the most recently executed foreground pipeline.
$-	| A hyphen expands to the current option flags as specified upon invocation, by the set built-in command, or those set by the shell itself (such as the -i).
$$	| Expands to the process ID of the shell.
$!	| Expands to the process ID of the most recently executed background (asynchronous) command.
$0	| Expands to the name of the shell or shell script.
$_	| The underscore variable is set at shell startup and contains the absolute file name of the shell or script being executed as passed in the argument list. Subsequently, it expands to the last argument to the previous command, after expansion. It is also set to the full pathname of each command executed and placed in the environment exported to that command. When checking mail, this parameter holds the name of the mail file.

> __In almost every case where coders use "$*", they mean "$@". "$*" Can cause bugs and even security holes in your software.__

**Good Practice**

```
BACKUPDIR=/home
BACKUPFILES=franky
TARFILE=/var/tmp/home_franky.tar
BZIPFILE=/var/tmp/home_franky.tar.bz2
SERVER=bordeaux
REMOTEDIR=/opt/backup/franky
LOGFILE=/home/franky/log/home_backup.log
```

for low bandwidth and large directories use `rsync`

##3.3 Quoting Characters
###3.3.2 Escape Characters

`\` It preserves the literal value of the next character that follows, with the exception of newline. If a newline character appears immediately after the backslash, it marks the continuation of a line when it is longer that the width of the terminal;

```
date=2001293
echo $date
echo \$date
```
###3.3.3 Single Quotes
`''` preserve literal value of each character enclosed within quotes

### 3.3.4 Double quotes
Using `"` the literal of all characters enclose is preserved, except for the `$` , backticks , `\`

within double quotes `\` are removed from the input stream when followed by one of these characters (`$` backtick `"` `\` newline). 

```
echo "$date"
echo "`date`"
echo "I'd say: \""
echo "\\"
```

### 3.3.5 ANSI-C quoting
$'STRING'

## 3.4 Shell expansion

After the command has been split into tokens 8 expansions

1. Brace expansion

which is performed before any other expansions and strictly textual

`echo sp{el,il,al}l`

2. Tilde expansion

`~loginname`

if loginname is null then `~` means the value of `HOME`

else if `HOME` unset, the home directory of user executing the shell is substituted. 

else `~` is replace with home directory associated with the specified login name

`~+` = `pwd`

`~-` = `OLDPWD`

`~+N` `~N` is replaced with corresponding element from the directory stack as it would be displayed by the dirs built-in invoked with the characters following tilde in the tilde-prefix as an argument

Each varaible assignment is checked for unquoted tilde-prefixes immediately following a ":" or "=".

```
export PATH="$PATH:~/testdir"
```


3. paramter expansion


```
${variable}
!a #indirect expansion
${VAR:=value} #create a named variable
```

4. Command substitution


```
$(date)
`date`
echo `whoam\`echo i\`` # to nest command substitutions, escape the inner ` with \
```

5. Arithmetic expansion

```
$(( EXPRESSION )) # All token in the expression undergo parameter expansion, command expansion and quote removal
a=1;b=2
$(( a+b ))
[BASE#]N
echo $((16#64))
echo $((64#64@_))
$((64#@_@_@@@@@@@@@@@@@_))

$[ EXPRESSION ] #whenever possible, Bash Users should try to use the syntax with square brackets.
```

6. Process substitution

support named pipes or `/dev/fd`

```
<(LIST)
>(LIST)
nl <(cat TOP1000.txt)
```

7. Word Splitting

```
$IFS #delimeters
$IFS unset, its value is "<space><tab><newline>"

If IFS has a value other than the default, then sequences of the whitespace characters "space" and "Tab" are ignored at the beginning and end of the word, as long as the whitespace character is in the value of IFS (an IFS whitespace character)
If the value of IFS is null, no word splitting occurs
```

8. File name expansion

```
without set -f, "*", "?", and "[" will treated as PATTERN
If no matching file names are found, and the shell option nullglob is disabled, the word is left unchanged
If the nullglob option is set, and no matches are found, the word is removed
If the shell option nocaseglob is enabled, the match is performed without regard to the case of alphabetic characters.
```

## 3.5 Aliases
```
root@test:~# alias
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'
alias l='ls -CF'
alias la='ls -A'
alias ll='ls -alF'
alias ls='ls --color=auto' # bash will not try to recursively expand the replacement text
```
Aliases are not expanded when the shell is not interactive, unless the expand_aliases option is set using the shopt shell built-in.

Aliases are expanded when a command is read, not when it is executed. To be safe, always put alias definitions on a separate line, and do not use alias in compound commands.

## 3.6 More Bash options
```
# Use the -o option to set to display all shell options
set -o 
# execute a script in POSIX-compatible mode
bash --posix script.sh
set -o noclobber # prevents existing files from being overwritten by redirection operations
touch test
date > test
set +o noclobber

#treat unset variables as an error when set, and exits a non-interactive shell upon encountering such errors
set -u
echo $VAR

# prevents special characters from being expanded
set -o noglob
touch *
```













