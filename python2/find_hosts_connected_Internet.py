# -*- coding: utf-8 -*-
import re
import paramiko
import os
import threading

def extract_ssh_hosts(path):
	try:
		if os.path.isfile(path):
			temp = []
			with open(path, 'r') as f:
				for line in f:
					# line = f.readline()
					regex = re.compile(r'(.*?):(.*?) \((.*?):(.*?)\).*?')
					m = regex.findall(line)
					temp.append(m[0])
				return temp
		else:
			print "[-] path is not available"
	except Exception, e:
		print e


def ssh_command(host, port, username, password, command):
	client = paramiko.SSHClient()
	client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
	client.connect(host,port, username=username, password=password)
	ssh_session = client.get_transport().open_session()
	# print ssh_session
	if ssh_session.active:
		ssh_session.exec_command(command)	
		if "0% packet loss" in ssh_session.recv(1024):
			print host

# ssh_command("192.168.10.129",22,"root","Yinhai!@#$",'curl ip.cn')
# extract_ssh_hosts()
filepath = os.path.join("F:\\", "Yinhai","渗透测试项目","info","内网ssh.txt")
filepath=unicode(filepath,'utf8')
tuple_list = extract_ssh_hosts(filepath)
for i in tuple_list:
	(username, password,host,port) = i
	threading.Thread(target=ssh_command, args=(host, port, username, password, 'ping -c 1 www.baidu.com')).start()